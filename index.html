<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>מחשבון חדלות פירעון</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary:#005f73; --secondary:#0a9396; --bg:#f4f4f4; --card:#fff;
      --text:#333; --label:#555; --border:#ddd; --accent:#ee9b00;
      --result-bg:#e9f5f5; --danger:#ae2012; --info:#fff3cd; --info-border:#ffe8a6; --blue:#007bff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:'Heebo',sans-serif}
    header{background:var(--primary);color:#fff;padding:18px 20px;text-align:center}
    header h1{margin:0;font-size:1.9rem;display:inline-flex;gap:.75rem;align-items:baseline}
    header .version{font-size:.95rem;opacity:.9;background:rgba(255,255,255,.15);padding:2px 8px;border-radius:12px}

    .calculator{max-width:1100px;margin:20px auto;display:grid;grid-template-columns:1fr 1fr;gap:0;box-shadow:0 4px 14px rgba(0,0,0,.07);border-radius:12px;overflow:hidden}
    .left,.right{padding:22px}
    .left{background:var(--result-bg)}
    .right{background:var(--card);border-inline-start:1px solid var(--border)}

    h2.title{margin:0 0 12px;color:var(--primary);border-bottom:2px solid var(--secondary);padding-bottom:8px;font-size:1.25rem}

    /* כפתורי דו"ח + מתקפלים */
    .report-bar{display:flex;align-items:center;gap:10px;margin-bottom:10px;flex-wrap:wrap}
    .btn{border:1px solid var(--border);background:#fff;border-radius:12px;padding:8px 12px;cursor:pointer}
    .btn:hover{border-color:var(--secondary)}
    .chip{border:1px solid var(--border);background:#fff;border-radius:999px;padding:6px 12px;cursor:pointer;display:inline-flex;align-items:center;gap:6px}
    .chip.active{background:var(--secondary);color:#fff;border-color:var(--secondary)}

    .collapse{border:1px solid var(--border);background:#fff;border-radius:10px;margin:6px 0;overflow:hidden}
    .collapse-toggle{display:flex;align-items:center;gap:8px;width:100%;padding:10px 12px;background:#fafafa;border:0;cursor:pointer;text-align:right}
    .collapse-content{display:none;padding:12px}
    .collapse.open .collapse-content{display:block}

    .inline-fields{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .input{display:flex;flex-direction:column;gap:6px}
    label{color:var(--label);font-weight:500}
    input[type="text"],input[type="number"],select,textarea{
      width:100%;padding:10px;border:1px solid var(--border);border-radius:8px;font-size:1rem
    }
    textarea{min-height:70px;resize:vertical}
    .muted{font-size:.85rem;color:#666}

    /* תוצאות */
    .result-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #d4e7e7}
    .result-row:last-child{border-bottom:none}
    .result-row .value{font-weight:700;color:var(--accent)}
    .result-row .value.big{color:var(--blue);font-size:1.35rem}
    .result-row.total .value{color:var(--danger);font-size:1.35rem}

    /* זוגות שדות */
    .pair{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin:8px 0 14px}
    .pair .input.debtor{grid-column:1}   /* חייב/ת משמאל */
    .pair .input.partner{grid-column:2}  /* בן/בת זוג מימין */

    /* טולטיפים */
    .help-wrap{position:relative;display:inline-block}
    .help{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%;border:1px solid var(--border);cursor:pointer;background:#fff;margin-inline-start:6px}
    .tooltip{position:absolute;inset-inline-start:0;top:28px;min-width:220px;max-width:300px;background:var(--info);border:1px solid var(--info-border);color:#5b4c00;padding:10px;border-radius:10px;box-shadow:0 6px 16px rgba(0,0,0,.08);display:none;z-index:10}
    .tooltip.show{display:block}

    .note{background:var(--info);border:1px solid var(--info-border);color:#5b4c00;border-radius:10px;padding:12px;margin-top:10px}

    @media print{
      .report-bar,.chip,.collapse-toggle,.help,.note-tip{display:none !important}
      .collapse-content{display:block !important}
      header{position:static}
      .calculator{box-shadow:none}
    }

    @media (max-width:900px){
      .calculator{grid-template-columns:1fr}
      .right{border-inline-start:none;border-top:1px solid var(--border)}
      .pair{grid-template-columns:1fr}
      .pair .input.debtor,.pair .input.partner{grid-column:auto}
    }
  </style>
</head>
<body>
  <header>
    <h1><span class="version">גרסה 2025</span> מחשבון צו תשלומים</h1>
  </header>

  <div class="calculator">
    <!-- LEFT -->
    <section class="left">
      <div class="report-bar">
        <button id="btnPrint" class="btn">🖨️ הדפס/צילום</button>
        <button id="btnMail" class="btn">✉️ שלח מייל</button>
        <span id="mailTip" class="note-tip" style="display:none;color:#5b4c00;background:var(--info);border:1px solid var(--info-border);padding:6px 10px;border-radius:10px">
          שמור/הדפס ל-PDF ואז צרף לקובץ המייל.
        </span>
      </div>

      <div class="collapse" id="reportCollapse">
        <button class="collapse-toggle" type="button">📄 פרטי הדו"ח</button>
        <div class="collapse-content">
          <div class="inline-fields">
            <div class="input">
              <label>מס׳ תיק</label>
              <input type="text" id="caseNo" placeholder="למשל: 12345/25" />
            </div>
            <div class="input">
              <label>שם עורך/ת החישוב</label>
              <input type="text" id="authorName" placeholder="שם מלא" />
            </div>
          </div>
          <div class="input" style="max-width:220px">
            <label>תאריך</label>
            <input type="text" id="reportDate" readonly />
          </div>
        </div>
      </div>

      <div class="collapse" id="noteCollapse">
        <button class="collapse-toggle" type="button">📝 הוספת הערה (עד 500 תווים)</button>
        <div class="collapse-content">
          <div class="input">
            <textarea id="userNote" maxlength="500" placeholder="רשום/י כאן הערות לביצוע/הבהרות..."></textarea>
            <div class="muted"><span id="noteCount">0</span>/500</div>
          </div>
        </div>
      </div>

      <h2 class="title">תוצאות החישוב</h2>

      <div class="result-row">
        <div>קצבת ביטוח לאומי:</div><div class="value" id="socialSecurityAllowance">0 ₪</div>
      </div>
      <div class="result-row">
        <div>סך הכנסות:</div><div class="value" id="totalIncomeResult">0 ₪</div>
      </div>
      <div class="result-row">
        <div id="livingCostLabel">דמי מחייה בכבוד:</div><div class="value" id="baseLivingCostResult">0 ₪</div>
      </div>
      <div class="result-row">
        <div>סך הוצאות:</div><div class="value" id="totalExpensesResult">0 ₪</div>
      </div>
      <div class="result-row">
        <div>הכנסה פנויה לתא המשפחתי:</div><div class="value big" id="disposableIncomeResult">0 ₪</div>
      </div>
      <div class="result-row">
        <div id="debtorIncomeRatioLabel">אחוז הכנסה (חייב/ת):</div><div class="value" id="debtorIncomeRatio">0%</div>
      </div>
      <div class="result-row">
        <div id="partnerIncomeRatioLabel">אחוז הכנסה (בן/בת זוג):</div><div class="value" id="partnerIncomeRatio">0%</div>
      </div>
      <div class="result-row">
        <div id="debtorPaymentLabel">תשלום מוצע (חייב/ת):</div><div class="value" id="debtorPaymentResult">0 ₪</div>
      </div>
      <div class="result-row">
        <div id="partnerPaymentLabel">תשלום מוצע (בן/בת זוג):</div><div class="value" id="partnerPaymentResult">0 ₪</div>
      </div>
      <div class="result-row total">
        <div>תשלום חודשי לתא משפחתי:</div><div class="value" id="finalPaymentResult">0 ₪</div>
      </div>

      <div class="note">
        <strong>הערה:</strong> לחייב שלא עובד יקבע תשלום זמני של 150 ₪ ותשלום עתידי החל מ-3 חודשים קדימה עפ"י הכנסה רעיונית של שכר מינימום בסך <strong>6,247.67 ₪</strong>.
      </div>
    </section>

    <!-- RIGHT -->
    <section class="right">
      <h2 class="title">פרטי התא המשפחתי</h2>

      <div class="input" style="max-width:420px">
        <label class="muted">סטטוס משפחתי</label>
        <select id="status">
          <option value="" selected disabled>בחר סטטוס...</option>
          <option value="יחיד/נשוי חי בנפרד">יחיד/נשוי חי בנפרד</option>
          <option value="רווק/גרוש/אלמן + ילד">רווק/גרוש/אלמן + ילד</option>
          <option value="זוג">זוג</option>
          <option value="זוג+ילד">זוג+ילד</option>
          <option value="זוג+ 2 ילדים">זוג+ 2 ילדים</option>
          <option value="זוג+ 3 ילדים">זוג+ 3 ילדים</option>
          <option value="זוג+ 4 ילדים">זוג+ 4 ילדים</option>
          <option value="זוג+ 5 ילדים">זוג+ 5 ילדים</option>
          <option value="זוג+ 6 ילדים">זוג+ 6 ילדים</option>
          <option value="זוג+ 7 ילדים">זוג+ 7 ילדים</option>
          <option value="זוג+ 8 ילדים">זוג+ 8 ילדים</option>
          <option value="זוג+ 9 ילדים">זוג+ 9 ילדים</option>
          <option value="זוג+ 10 ילדים">זוג+ 10 ילדים</option>
        </select>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin:8px 0 14px">
        <span class="chip active" id="chipDebtor">חייב</span>
        <span class="chip" id="chipDebtorF">חייבת</span>
        <span class="chip" id="chipJoint">שני בני הזוג בהליך?</span>
      </div>

      <h2 class="title">(₪) הכנסות והוצאות התא המשפחתי</h2>

      <!-- שכר -->
      <div class="pair">
        <div class="input debtor" id="salaryDebtorGroup">
          <label id="salaryDebtorLabel">
            הכנסה (חייב/ת)
            <span class="help-wrap">
              <span class="help" data-tip="tipDebtor">?</span>
              <span class="tooltip" id="tipDebtor">
                <strong>ממוצע נטו תלושי שכר.</strong><br>
                לחייב שלא עובד יקבע תשלום זמני של 150 ₪ ותשלום עתידי החל מ-3 חודשים קדימה עפ״י הכנסה רעיונית של שכר מינימום בסך 6,247.67 ₪.
              </span>
            </span>
          </label>
          <input type="number" id="salaryDebtor" placeholder="הזן הכנסה" />
        </div>
        <div class="input partner" id="salaryPartnerGroup">
          <label id="salaryPartnerLabel">
            הכנסה (בן/בת זוג)
            <span class="help-wrap">
              <span class="help" data-tip="tipPartner">?</span>
              <span class="tooltip" id="tipPartner">
                <strong>ממוצע נטו תלושי שכר.</strong><br>
                במקרה שבן/בת הזוג לא עובד/ת ייקבע תשלום מדורג בהתבסס על הכנסה רעיונית של שכר מינימום בסך 6,247.67 ₪.
              </span>
            </span>
          </label>
          <input type="number" id="salaryPartner" placeholder="הזן הכנסה" />
        </div>
      </div>

      <!-- הכנסות אחרות -->
      <div class="pair">
        <div class="input debtor" id="otherIncomeDebtorGroup">
          <label id="otherIncomeDebtorLabel">הכנסות אחרות (חייב/ת)</label>
          <input type="number" id="otherIncomeDebtor" placeholder="הזן הכנסות אחרות" />
        </div>
        <div class="input partner" id="otherIncomePartnerGroup">
          <label id="otherIncomePartnerLabel">הכנסות אחרות (בן/בת זוג)</label>
          <input type="number" id="otherIncomePartner" placeholder="הזן הכנסות אחרות" />
        </div>
      </div>

      <!-- קצבאות -->
      <div class="pair">
        <div class="input debtor">
          <label id="debtorAllowanceLabel">קצבה (חייב/ת)</label>
          <input type="number" id="debtorAllowance" placeholder="הזן קצבה" />
        </div>
        <div class="input partner" id="partnerAllowanceGroup">
          <label id="partnerAllowanceLabel">קצבה (בן/בת זוג)</label>
          <input type="number" id="partnerAllowance" placeholder="הזן קצבה" />
        </div>
      </div>

      <!-- הוצאות -->
      <div class="pair">
        <div class="input">
          <label>הוצאות חריגות (רפואיות וכו')</label>
          <input type="number" id="unusualExpenses" placeholder="הזן הוצאות" />
        </div>
        <div class="input">
          <label>הוצאות טיפול וצהרונים</label>
          <input type="number" id="childcareExpenses" placeholder="הזן הוצאות" />
        </div>
      </div>

      <div class="input">
        <label>הוצאות מזונות</label>
        <input type="number" id="alimonyExpenses" placeholder="הזן הוצאות מזונות" />
      </div>
    </section>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // נתונים
      const lookupData = {
        "יחיד/נשוי חי בנפרד": { kids: 0, livingCost: 4556 },
        "רווק/גרוש/אלמן + ילד": { kids: 1, livingCost: 6056 },
        "זוג": { kids: 0, livingCost: 6024 },
        "זוג+ילד": { kids: 1, livingCost: 7524 },
        "זוג+ 2 ילדים": { kids: 2, livingCost: 9024 },
        "זוג+ 3 ילדים": { kids: 3, livingCost: 10524 },
        "זוג+ 4 ילדים": { kids: 4, livingCost: 12024 },
        "זוג+ 5 ילדים": { kids: 5, livingCost: 13324 },
        "זוג+ 6 ילדים": { kids: 6, livingCost: 14624 },
        "זוג+ 7 ילדים": { kids: 7, livingCost: 15924 },
        "זוג+ 8 ילדים": { kids: 8, livingCost: 17224 },
        "זוג+ 9 ילדים": { kids: 9, livingCost: 18524 },
        "זוג+ 10 ילדים": { kids: 10, livingCost: 19824 }
      };
      const childAllowanceData = {0:0,1:169,2:383,3:597,4:811,5:980,6:1149,7:1318,8:1487,9:1656,10:1825};

      // אלמנטים
      const statusEl = document.getElementById('status');
      const chipDebtor = document.getElementById('chipDebtor');
      const chipDebtorF = document.getElementById('chipDebtorF');
      const chipJoint = document.getElementById('chipJoint');

      const salaryDebtorEl = document.getElementById('salaryDebtor');
      const salaryPartnerEl = document.getElementById('salaryPartner');
      const otherIncomeDebtorEl = document.getElementById('otherIncomeDebtor');
      const otherIncomePartnerEl = document.getElementById('otherIncomePartner');
      const debtorAllowanceEl = document.getElementById('debtorAllowance');
      const partnerAllowanceEl = document.getElementById('partnerAllowance');
      const unusualExpensesEl = document.getElementById('unusualExpenses');
      const childcareExpensesEl = document.getElementById('childcareExpenses');
      const alimonyExpensesEl = document.getElementById('alimonyExpenses');

      const salaryDebtorGroup = document.getElementById('salaryDebtorGroup');
      const salaryPartnerGroup = document.getElementById('salaryPartnerGroup');
      const otherIncomeDebtorGroup = document.getElementById('otherIncomeDebtorGroup');
      const otherIncomePartnerGroup = document.getElementById('otherIncomePartnerGroup');
      const partnerAllowanceGroup = document.getElementById('partnerAllowanceGroup');

      const salaryDebtorLabelEl = document.getElementById('salaryDebtorLabel');
      const salaryPartnerLabelEl = document.getElementById('salaryPartnerLabel');
      const otherIncomeDebtorLabelEl = document.getElementById('otherIncomeDebtorLabel');
      const otherIncomePartnerLabelEl = document.getElementById('otherIncomePartnerLabel');
      const debtorAllowanceLabelEl = document.getElementById('debtorAllowanceLabel');
      const partnerAllowanceLabelEl = document.getElementById('partnerAllowanceLabel');

      const socialSecurityAllowanceEl = document.getElementById('socialSecurityAllowance');
      const totalIncomeResultEl = document.getElementById('totalIncomeResult');
      const baseLivingCostResultEl = document.getElementById('baseLivingCostResult');
      const totalExpensesResultEl = document.getElementById('totalExpensesResult');
      const disposableIncomeResultEl = document.getElementById('disposableIncomeResult');
      const debtorIncomeRatioEl = document.getElementById('debtorIncomeRatio');
      const partnerIncomeRatioEl = document.getElementById('partnerIncomeRatio');
      const debtorPaymentResultEl = document.getElementById('debtorPaymentResult');
      const partnerPaymentResultEl = document.getElementById('partnerPaymentResult');
      const finalPaymentResultEl = document.getElementById('finalPaymentResult');
      const debtorIncomeRatioLabelEl = document.getElementById('debtorIncomeRatioLabel');
      const partnerIncomeRatioLabelEl = document.getElementById('partnerIncomeRatioLabel');
      const debtorPaymentLabelEl = document.getElementById('debtorPaymentLabel');
      const partnerPaymentLabelEl = document.getElementById('partnerPaymentLabel');

      const btnPrint = document.getElementById('btnPrint');
      const btnMail = document.getElementById('btnMail');
      const mailTip = document.getElementById('mailTip');

      const noteCollapse = document.getElementById('noteCollapse');
      const reportCollapse = document.getElementById('reportCollapse');
      const userNoteEl = document.getElementById('userNote');
      const noteCountEl = document.getElementById('noteCount');
      const reportDateEl = document.getElementById('reportDate');

      // מצב
      let isMaleDebtor = true;
      let isJointProceeding = false;

      // utils
      const formatCurrency = n => new Intl.NumberFormat('he-IL',{style:'currency',currency:'ILS',minimumFractionDigits:0}).format(Number(n)||0);
      const round10 = n => Math.floor((Number(n)||0)/10)*10;

      // init date
      const today = new Date();
      reportDateEl.value = today.toLocaleDateString('he-IL');

      // collapse toggles
      document.querySelectorAll('.collapse-toggle').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          btn.parentElement.classList.toggle('open');
        });
      });

      // tooltip toggles
      document.querySelectorAll('.help').forEach(h=>{
        h.addEventListener('click', ()=>{
          const id = h.getAttribute('data-tip');
          const tip = document.getElementById(id);
          tip.classList.toggle('show');
        });
      });
      document.addEventListener('click', (e)=>{
        if(!e.target.classList.contains('help')){
          document.querySelectorAll('.tooltip').forEach(t=>t.classList.remove('show'));
        }
      }, true);

      // mail tip
      btnMail.addEventListener('click', ()=>{ mailTip.style.display='inline-block'; setTimeout(()=>mailTip.style.display='none', 3500); });

      // print
      btnPrint.addEventListener('click', ()=>window.print());

      // chips
      function setDebtorGender(male){
        isMaleDebtor = male;
        chipDebtor.classList.toggle('active', male);
        chipDebtorF.classList.toggle('active', !male);
        updateLabelsAndUI();
        calculate();
      }
      chipDebtor.addEventListener('click', ()=>setDebtorGender(true));
      chipDebtorF.addEventListener('click', ()=>setDebtorGender(false));
      chipJoint.addEventListener('click', ()=>{
        isJointProceeding = !isJointProceeding;
        chipJoint.classList.toggle('active', isJointProceeding);
        updateLabelsAndUI();
        calculate();
      });

      // note counter
      userNoteEl.addEventListener('input', ()=>{noteCountEl.textContent = userNoteEl.value.length});

      // UI + labels
      function updateLabelsAndUI(){
        const status = statusEl.value || '';
        const isSingle = status.includes('יחיד') || status.includes('רווק');

        // הצגת/הסתרת שדות בן/בת זוג
        const showPartner = !isSingle;
        [salaryPartnerGroup,otherIncomePartnerGroup,partnerAllowanceGroup].forEach(g=>{
          g.style.display = showPartner ? 'flex' : 'none';
        });

        // טקסטים
        const debtorText  = isSingle ? 'חייב/ת' : (isMaleDebtor ? 'חייב' : 'חייבת');
        const partnerText = isSingle ? 'בן/בת זוג' : (isMaleDebtor ? 'בת זוג' : 'בן זוג');

        salaryDebtorLabelEl.textContent = `הכנסה (${debtorText})`;
        salaryPartnerLabelEl.textContent = `הכנסה (${partnerText})`;
        otherIncomeDebtorLabelEl.textContent = `הכנסות אחרות (${debtorText})`;
        otherIncomePartnerLabelEl.textContent = `הכנסות אחרות (${partnerText})`;
        debtorAllowanceLabelEl.textContent = `קצבה (${debtorText})`;
        partnerAllowanceLabelEl.textContent = `קצבה (${partnerText})`;

        debtorIncomeRatioLabelEl.textContent = `אחוז הכנסה (${debtorText}):`;
        partnerIncomeRatioLabelEl.textContent = `אחוז הכנסה (${partnerText}):`;
        debtorPaymentLabelEl.textContent    = `תשלום מוצע (${debtorText}):`;
        partnerPaymentLabelEl.textContent   = `תשלום מוצע (${partnerText}):`;
      }

      // חישוב
      function calculate(){
        const st = statusEl.value || '';
        const kids = (lookupData[st]||{kids:0}).kids;
        const living = (lookupData[st]||{livingCost:0}).livingCost;

        const sd = +salaryDebtorEl.value || 0;
        const sp = +salaryPartnerEl.value || 0;
        const oid = +otherIncomeDebtorEl.value || 0;
        const oip = +otherIncomePartnerEl.value || 0;
        const ad = +debtorAllowanceEl.value || 0;
        const ap = +partnerAllowanceEl.value || 0;

        const ue = +unusualExpensesEl.value || 0;
        const ce = +childcareExpensesEl.value || 0;
        const al = +alimonyExpensesEl.value || 0;

        const childAllow = childAllowanceData[kids] || 0;

        baseLivingCostResultEl.textContent = formatCurrency(living);
        socialSecurityAllowanceEl.textContent = formatCurrency(childAllow);

        // יחסי הכנסה (שכר+אחרות בלבד)
        const ratioBase = sd + oid + sp + oip;
        const rDebtor = ratioBase>0 ? (sd+oid)/ratioBase : 0;
        const rPartner= ratioBase>0 ? (sp+oip)/ratioBase : 0;

        debtorIncomeRatioEl.textContent = (rDebtor*100).toFixed(1)+'%';
        partnerIncomeRatioEl.textContent = (rPartner*100).toFixed(1)+'%';

        const totalIncome = sd+sp+oid+oip+ad+ap+childAllow;
        totalIncomeResultEl.textContent = formatCurrency(totalIncome);

        const totalExpenses = living+ue+ce+al;
        totalExpensesResultEl.textContent = formatCurrency(totalExpenses);

        const disposable = totalIncome - totalExpenses;
        disposableIncomeResultEl.textContent = disposable<0 ? 'אין הכנסה פנויה' : formatCurrency(disposable);

        // תשלומים מוצעים לפי יחס/2
        const payDebtor  = rDebtor  >0 ? round10((Math.max(disposable,0)*rDebtor)/2)  : 0;
        const payPartner = rPartner >0 ? round10((Math.max(disposable,0)*rPartner)/2) : 0;

        debtorPaymentResultEl.textContent  = formatCurrency(Math.max(0,payDebtor));
        partnerPaymentResultEl.textContent = formatCurrency(Math.max(0,payPartner));

        const isSingle = st.includes('יחיד') || st.includes('רווק');

        // נוסחה מעודכנת לזוג בהליך:
        // final = round10( ((DI/2 - partnerPay) * rDebtor) + partnerPay )
        let final = 0;
        if(isSingle){
          final = Math.max(0,payDebtor);
        }else if(isJointProceeding){
          const baseHalf = Math.max(disposable,0)/2;
          const afterMinusPartner = Math.max(baseHalf - Math.max(0,payPartner), 0);
          final = round10(afterMinusPartner * rDebtor + Math.max(0,payPartner));
        }else{
          final = Math.max(0,payDebtor);
        }
        finalPaymentResultEl.textContent = formatCurrency(final);
      }

      // אירועים
      document.querySelectorAll('input,select').forEach(el=>{
        el.addEventListener('input', ()=>{updateLabelsAndUI();calculate();});
        el.addEventListener('change', ()=>{updateLabelsAndUI();calculate();});
      });
      statusEl.addEventListener('change', ()=>{updateLabelsAndUI();calculate();});

      // התחלה
      updateLabelsAndUI();
      calculate();
    });
  </script>
</body>
</html>
