<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>מחשבון חדלות פירעון</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{
  --primary:#005f73; --secondary:#0a9396; --bg:#f5f7fa; --panel:#ffffff;
  --text:#23323a; --muted:#6b7c89; --border:#dbe3ea; --accent:#ee9b00;
  --danger:#b02a37; --blue:#1063ff; --soft:#e9f5f5;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:'Heebo',sans-serif;display:flex;justify-content:center;padding:22px}
#captureRoot{width:100%;max-width:1100px}
.calculator{
  background:var(--panel);border-radius:12px;overflow:hidden;box-shadow:0 6px 20px rgba(0,0,0,.08);
  display:grid;grid-template-columns:1fr 1fr;
}
header{grid-column:1/-1;background:var(--primary);color:#fff;padding:16px 18px}
.h-title{margin:0;text-align:center;font-size:1.8rem;font-weight:800}
.badge{display:inline-block;background:rgba(255,255,255,.12);padding:.25rem .6rem;border-radius:999px;margin-inline-start:8px;font-size:.9rem}

.col{padding:22px}
.col.inputs{border-inline-end:1px solid var(--border)}      /* קלט – משמאל */
.col.results{}                                             /* תוצאות – מימין */

/* היפוך מיקום בעמודת דסקטופ: תוצאות מימין, קלט משמאל */
@media (min-width:769px){
  .col.results{grid-column:2}
  .col.inputs{grid-column:1}
}

/* כותרות מקטעים */
h2.sec{margin:0 0 14px;color:var(--primary);font-size:1.2rem;padding-bottom:6px;border-bottom:2px solid var(--secondary)}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}

/* טופס – מראה נקי וקריא */
.input{display:flex;flex-direction:column;gap:6px}
.input label{font-weight:600;color:#385468}
.input input,.input select,.input textarea{
  width:100%;padding:11px 12px;border:1.2px solid #cfd8e1;border-radius:10px;
  background:#fff;box-shadow:inset 0 0 0 1000px #fff; font-size:1rem
}
.input input:focus,.input select:focus,.input textarea:focus{
  outline:none;border-color:var(--secondary);box-shadow:0 0 0 3px rgba(10,147,150,.18)
}

/* מי בהליך – גלולות */
.pills{display:flex;gap:8px;flex-wrap:wrap;align-items:flex-start}
.pill{border:1px solid #d7e0e8;background:#f7fafc;padding:8px 14px;border-radius:999px;cursor:pointer;font-weight:700}
.pill.active{background:var(--secondary);border-color:var(--secondary);color:#fff}
.pill.alert{white-space:normal;line-height:1.1;transform:translateY(-6px)} /* מוגבהת וקצת גלישת טקסט */
.pill.alert.active{background:#d94135;border-color:#d94135;color:#fff}

/* כרטיסי תוצאות */
.cards{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.card{
  background:#fff;border:1px solid var(--border);border-radius:14px;padding:14px;text-align:center;
  box-shadow:0 2px 8px rgba(0,0,0,.04)
}
.card .label{color:#415563;font-weight:700;margin-bottom:6px}
.card .value{font-weight:900;color:var(--accent);font-size:1.25rem}
.card.blue .value{color:var(--blue)}
.card.full{grid-column:1/-1}
#finalPayCard{border:2px dashed #ced8ff}
#zeroCase{display:none;color:#b00020;background:#ffe6ea;border:1px solid #ffc2cd;padding:2px 10px;border-radius:10px;font-weight:900;margin-top:4px}

/* כפתורים בדסקטופ */
.actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border:1px solid #cbd5e1;background:#fff;border-radius:10px;cursor:pointer;font-weight:800;box-shadow:0 2px 6px rgba(0,0,0,.05)}
.btn:hover{background:#f7fafc}
.btn.reset{border-color:#ffced1}
.btn .ico{font-size:1.05rem}

/* בועיות מידע */
.info{width:20px;height:20px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:#eef6f6;border:1px solid #e1ecec;color:#006d77;cursor:pointer;font-weight:800}
.pop{position:absolute;z-index:1000;max-width:320px;background:#fff7d6;color:#3b2f00;border:1px solid #ffe6a8;border-radius:14px;box-shadow:0 12px 28px rgba(0,0,0,.15);padding:12px 14px;line-height:1.45}

/* הדפסה – לא נוגעים כרגע במובייל */
@media print{ body{padding:0;background:#fff} .actions{display:none} }
</style>
</head>
<body>
<div id="captureRoot">
  <div class="calculator" id="calc">
    <header>
      <h1 class="h-title">מחשבון צו תשלומים <span class="badge">מעודכן ל-<span id="year"></span></span></h1>
    </header>

    <!-- קלטים – משמאל -->
    <div class="col inputs" id="sectionInputs">
      <h2 class="sec">פרטי התא המשפחתי</h2>

      <!-- סטטוס + מי בהליך באותה שורה -->
      <div class="grid2">
        <div class="input">
          <label for="status">סטטוס משפחתי</label>
          <select id="status">
            <option value="" selected disabled>בחר סטטוס משפחתי…</option>
            <option value="יחיד/נשוי חי בנפרד">יחיד/נשוי חי בנפרד</option>
            <option value="רווק/גרוש/אלמן + ילד">רווק/גרוש/אלמן + ילד</option>
            <option value="זוג">זוג</option>
            <option value="זוג+ילד">זוג+ילד</option>
            <option value="זוג+ 2 ילדים">זוג+ 2 ילדים</option>
            <option value="זוג+ 3 ילדים">זוג+ 3 ילדים</option>
            <option value="זוג+ 4 ילדים">זוג+ 4 ילדים</option>
            <option value="זוג+ 5 ילדים">זוג+ 5 ילדים</option>
            <option value="זוג+ 6 ילדים">זוג+ 6 ילדים</option>
            <option value="זוג+ 7 ילדים">זוג+ 7 ילדים</option>
            <option value="זוג+ 8 ילדים">זוג+ 8 ילדים</option>
            <option value="זוג+ 9 ילדים">זוג+ 9 ילדים</option>
            <option value="זוג+ 10 ילדים">זוג+ 10 ילדים</option>
          </select>
        </div>
        <div class="input">
          <label>מי בהליך?</label>
          <div class="pills">
            <div class="pill active" id="pillMale">חייב</div>
            <div class="pill" id="pillFemale">חייבת</div>
            <div class="pill alert" id="pillJoint">שני בני הזוג בהליך</div>
          </div>
        </div>
      </div>

      <h2 class="sec">הכנסות והוצאות התא המשפחתי (₪)</h2>

      <div class="grid2">
        <div class="input" id="salaryDebtorWrap">
          <label><span id="salaryDebtorLabel">הכנסה (חייב)</span>
            <span class="info" data-info="ממוצע נטו תלושי שכר<br>לחייב שלא עובד יקבע תשלום זמני של 150 ₪ ותשלום עתידי החל מ־3 חודשים קדימה עפ״י הכנסה רעיונית של שכר מינימום בסך 6,247.67 ₪">?</span>
          </label>
          <input id="salaryDebtor" type="number" placeholder="הזן הכנסה">
        </div>
        <div class="input" id="salaryPartnerWrap">
          <label><span id="salaryPartnerLabel">הכנסה (בן/בת זוג)</span>
            <span class="info" data-info="ממוצע נטו תלושי שכר<br>במקרה שבן/בת הזוג לא עובד/ת ייקבע תשלום מדורג בהתבסס על הכנסה רעיונית של שכר מינימום בסך 6,247.67 ₪">?</span>
          </label>
          <input id="salaryPartner" type="number" placeholder="הזן הכנסה">
        </div>
      </div>

      <div class="grid2">
        <div class="input"><label id="otherDebtorLabel">הכנסות אחרות (חייב)</label><input id="otherDebtor" type="number" placeholder="הזן הכנסות אחרות"></div>
        <div class="input" id="otherPartnerWrap"><label id="otherPartnerLabel">הכנסות אחרות (בן/בת זוג)</label><input id="otherPartner" type="number" placeholder="הזן הכנסות אחרות"></div>
      </div>

      <div class="grid2" style="margin-top:6px">
        <div class="input"><label>הוצאות חריגות (רפואיות וכו')</label><input id="unusual" type="number" placeholder="הזן הוצאות"></div>
        <div class="input"><label>הוצאות טיפול וצהרונים</label><input id="childcare" type="number" placeholder="הזן הוצאות"></div>
      </div>

      <div class="grid2" style="margin-top:6px">
        <div class="input">
          <label>הכנסות מקצבאות (חייב/ת)</label>
          <input id="allowDebtor" type="number" placeholder="קצבאות חייב/ת">
        </div>
        <div class="input" id="allowPartnerWrap">
          <label>הכנסות מקצבאות (בן/בת זוג)</label>
          <input id="allowPartner" type="number" placeholder="קצבאות בן/בת זוג">
        </div>
      </div>

      <div class="grid2" style="margin-top:6px">
        <div class="input"><label>הוצאות מזונות</label><input id="alimony" type="number" placeholder="הזן הוצאות מזונות"></div>
        <div class="input"></div>
      </div>
    </div>

    <!-- תוצאות – מימין -->
    <div class="col results" id="sectionResults">
      <h2 class="sec">תוצאות החישוב</h2>

      <div class="cards">
        <div class="card"><div class="label">קצבת ביטוח לאומי</div><div class="value" id="childAllowance">0 ₪</div></div>
        <div class="card"><div class="label">סך הכנסות</div><div class="value" id="totalIncome">0 ₪</div></div>

        <div class="card"><div class="label">דמי מחייה בכבוד</div><div class="value" id="livingCost">0 ₪</div></div>
        <div class="card"><div class="label">סך הוצאות</div><div class="value" id="totalExpenses">0 ₪</div></div>

        <div class="card blue full">
          <div class="label">הכנסה פנויה לתא המשפחתי</div>
          <div class="value" id="disposable">0 ₪</div>
        </div>

        <div class="card"><div class="label" id="debtorRatioLabel">אחוז הכנסה (חייב/ת)</div><div class="value" id="debtorRatio">0%</div></div>
        <div class="card"><div class="label" id="partnerRatioLabel">אחוז הכנסה (בן/בת זוג)</div><div class="value" id="partnerRatio">0%</div></div>

        <div class="card"><div class="label" id="debtorPayLabel">תשלום מוצע (חייב/ת)</div><div class="value" id="debtorPay">0 ₪</div></div>
        <div class="card"><div class="label" id="partnerPayLabel">תשלום מוצע (בן/בת זוג)</div><div class="value" id="partnerPay">0 ₪</div></div>

        <div class="card full" id="finalPayCard">
          <div class="label">תשלום חודשי לתא משפחתי</div>
          <div class="value" id="finalPay" style="font-size:1.6rem">0 ₪</div>
          <div id="zeroCase">תיק אפס</div>
        </div>
      </div>

      <div class="actions" id="deskActions">
        <button class="btn" id="btnReport"><span class="ico">🗂️</span> פרטי דו״ח</button>
        <button class="btn" id="btnShot"><span class="ico">🖨️</span> צילום/הדפס</button>
        <button class="btn" id="btnMail"><span class="ico">✉️</span> שליחת מייל</button>
        <button class="btn reset" id="btnReset"><span class="ico">↺</span> איפוס</button>
      </div>

      <div id="reportPanel" style="display:none;margin-top:10px">
        <div class="grid2">
          <div class="input"><label for="caseId">מס' תיק</label><input id="caseId" placeholder="12345/25"></div>
          <div class="input"><label for="authorName">שם עורך/ת החישוב</label><input id="authorName" placeholder="שם מלא"></div>
        </div>
        <div class="grid2" style="margin-top:10px">
          <div class="input" style="max-width:240px"><label for="calcDate">תאריך</label><input id="calcDate" readonly></div>
          <div class="input">
            <label for="calcNotes">הערה (עד 500 תווים)</label>
            <textarea id="calcNotes" maxlength="500" placeholder="הערה קצרה..."></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- html2canvas רק לצילום/הדפסה (דסקטופ) -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
const $=id=>document.getElementById(id);
$('year').textContent=new Date().getFullYear();
$('calcDate').value=new Date().toLocaleDateString('he-IL',{year:'numeric',month:'2-digit',day:'2-digit'});

/* טבלאות */
const living={"יחיד/נשוי חי בנפרד":4556,"רווק/גרוש/אלמן + ילד":6056,"זוג":6024,"זוג+ילד":7524,"זוג+ 2 ילדים":9024,"זוג+ 3 ילדים":10524,"זוג+ 4 ילדים":12024,"זוג+ 5 ילדים":13324,"זוג+ 6 ילדים":14624,"זוג+ 7 ילדים":15924,"זוג+ 8 ילדים":17224,"זוג+ 9 ילדים":18524,"זוג+ 10 ילדים":19824};
const childAll={0:0,1:169,2:383,3:597,4:811,5:980,6:1149,7:1318,8:1487,9:1656,10:1825};
const fmt=n=>new Intl.NumberFormat('he-IL',{style:'currency',currency:'ILS',minimumFractionDigits:0}).format(+n||0);
const rd10=n=>Math.max(0,Math.floor((+n||0)/10)*10);

/* מצב מי בהליך */
let male=true, joint=false;
$('pillMale').onclick = ()=>{male=true;  $('pillMale').classList.add('active');$('pillFemale').classList.remove('active');calc();updateLabels();}
$('pillFemale').onclick= ()=>{male=false; $('pillFemale').classList.add('active');$('pillMale').classList.remove('active');calc();updateLabels();}
$('pillJoint').onclick = ()=>{joint=!joint; $('pillJoint').classList.toggle('active',joint); calc(); updateLabels();}

/* עדכון תוויות */
function updateLabels(){
  const st=$('status').value||'';
  const single = st.includes('יחיד')||st.includes('רווק');
  // הצגת שדות בן/בת זוג
  ['salaryPartnerWrap','otherPartnerWrap','allowPartnerWrap'].forEach(id=>$(id).style.display= single?'none':'block');
  const debtor = single?'חייב/ת':(male?'חייב':'חייבת');
  const partner= single?'בן/בת זוג':(male?'בת זוג':'בן זוג');
  $('salaryDebtorLabel').textContent=`הכנסה (${debtor})`;
  $('salaryPartnerLabel').textContent=`הכנסה (${partner})`;
  $('otherDebtorLabel').textContent =`הכנסות אחרות (${debtor})`;
  $('otherPartnerLabel').textContent=`הכנסות אחרות (${partner})`;
  $('debtorRatioLabel').textContent =`אחוז הכנסה (${debtor})`;
  $('partnerRatioLabel').textContent=`אחוז הכנסה (${partner})`;
  $('debtorPayLabel').textContent   =`תשלום מוצע (${debtor})`;
  $('partnerPayLabel').textContent  =`תשלום מוצע (${partner})`;
}

/* חישוב */
['status','salaryDebtor','salaryPartner','otherDebtor','otherPartner','allowDebtor','allowPartner','unusual','childcare','alimony']
.forEach(id=>$(id).addEventListener('input',()=>{updateLabels();calc()}));
updateLabels(); calc();

function calc(){
  const st=$('status').value||'';
  const kids=(st.match(/\d+/)?.[0])||(st.includes('ילד')?1:0);
  const base=living[st]||0, child=childAll[kids]||0;

  const SD=+($('salaryDebtor').value)||0, SP=+($('salaryPartner').value)||0;
  const OD=+($('otherDebtor').value)||0, OP=+($('otherPartner').value)||0;
  const AD=+($('allowDebtor').value)||0, AP=+($('allowPartner').value)||0;
  const UN=+($('unusual').value)||0, CH=+($('childcare').value)||0, AL=+($('alimony').value)||0;

  $('childAllowance').textContent=fmt(child);
  $('livingCost').textContent=fmt(base);

  const incomes=SD+SP+OD+OP+AD+AP+child;
  const expenses=base+UN+CH+AL;
  $('totalIncome').textContent=fmt(incomes);
  $('totalExpenses').textContent=fmt(expenses);

  const disp=incomes-expenses;
  $('disposable').textContent=disp<0?'אין הכנסה פנויה':fmt(disp);

  const forRatio=(SD+OD+SP+OP)||0;
  const rD=forRatio>0?(SD+OD)/forRatio:0;
  const rP=forRatio>0?(SP+OP)/forRatio:0;
  $('debtorRatio').textContent=(rD*100).toFixed(1)+'%';
  $('partnerRatio').textContent=(rP*100).toFixed(1)+'%';

  const dPay=rD>0?rd10((disp*rD)/2):0;
  const pPay=rP>0?rd10((disp*rP)/2):0;
  $('debtorPay').textContent=fmt(dPay);
  $('partnerPay').textContent=fmt(pPay);

  // "תיק אפס" – רק אם יש הכנסות מקצבאות בלבד ולחייב אין הכנסה
  const onlyAllow=(SD+SP+OD+OP)===0 && (AD+AP)>0;
  const zeroCase=onlyAllow && (SD+OD===0);
  $('zeroCase').style.display=zeroCase?'inline-block':'none';

  const single=st.includes('יחיד')||st.includes('רווק');
  let final=0;
  if(single || !joint){ final=dPay; }
  else{
    const baseHalf=disp/2;
    const afterSub=Math.max(0, baseHalf - pPay);
    final=rd10(afterSub*rD + pPay);
  }
  $('finalPay').textContent = (final===0 && zeroCase) ? 'תיק אפס' : fmt(final);
}

/* טיפ "?" */
let pop, popBtn;
document.addEventListener('click',(e)=>{
  const btn=e.target.closest('.info');
  if(btn){
    e.stopPropagation();
    if(pop && popBtn===btn){ pop.remove(); pop=null; return; }
    if(pop) pop.remove();
    popBtn=btn; pop=document.createElement('div'); pop.className='pop'; pop.innerHTML=btn.dataset.info; document.body.appendChild(pop);
    const r=btn.getBoundingClientRect(); pop.style.top=(window.scrollY+r.bottom+8)+'px'; pop.style.right=(window.innerWidth-r.right+8)+'px';
  } else if(pop){ pop.remove(); pop=null; }
});

/* צילום/הדפס (דסקטופ) */
async function shoot(){
  const root=document.getElementById('captureRoot');
  const canvas=await html2canvas(root,{scale:1.25,useCORS:true,windowWidth:root.scrollWidth,windowHeight:root.scrollHeight});
  const data=canvas.toDataURL('image/png');
  const w=window.open('','_blank');
  w.document.write(`<html><head><meta charset="utf-8"><title>צילום המסך</title>
  <style>@page{size:A4 portrait;margin:0} html,body{margin:0} .pg{height:100vh;display:flex;align-items:center;justify-content:center} img{max-width:100vw;max-height:100vh;object-fit:contain}</style>
  </head><body><div class="pg"><img src="${data}"></div></body></html>`);
  w.document.close(); setTimeout(()=>w.print(),300);
}
$('btnShot').onclick=shoot;

/* מייל (תקציר) */
function mail(){
  alert('טיפ: בצילום/הדפס שמור/י את הקובץ וצרף/י ידנית למייל.');
  const t=id=>($(id)?.textContent||'').trim();
  const subject=`מחשבון צו תשלומים – ${$('caseId')?.value||'ללא מספר תיק'}`;
  const body=[
    'שלום,','','מצורף צילום/PNG (לצרף ידנית).','',
    `תיק: ${$('caseId')?.value||'-'}`,`עורך/ת: ${$('authorName')?.value||'-'}`,`תאריך: ${$('calcDate')?.value||'-'}`,
    $('calcNotes')?.value?`הערה: ${$('calcNotes').value}`:'',
    '','תקציר: ',`סך הכנסות: ${t('totalIncome')}`,`סך הוצאות: ${t('totalExpenses')}`,
    `הכנסה פנויה: ${t('disposable')}`,`אחוז (חייב/ת): ${t('debtorRatio')}`,`אחוז (בן/בת זוג): ${t('partnerRatio')}`,
    `תשלום מוצע (חייב/ת): ${t('debtorPay')}`,`תשלום מוצע (בן/בת זוג): ${t('partnerPay')}`,
    `תשלום חודשי לתא משפחתי: ${t('finalPay')}`
  ].filter(Boolean).join('\n');
  window.location.href=`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}
$('btnMail').onclick=mail;

/* פרטי דו"ח / איפוס */
$('btnReport').onclick=()=>{const p=$('reportPanel');p.style.display=(p.style.display==='block')?'none':'block';};
$('btnReset').onclick=()=>{['salaryDebtor','salaryPartner','otherDebtor','otherPartner','allowDebtor','allowPartner','unusual','childcare','alimony'].forEach(id=>$(id).value='');$('status').value='';$('reportPanel').style.display='none';$('calcNotes').value='';male=true;joint=false;$('pillMale').classList.add('active');$('pillFemale').classList.remove('active');$('pillJoint').classList.remove('active');updateLabels();calc();};
</script>
</body>
</html>
