<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>מחשבון חדלות פירעון</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
:root{
  --primary:#005f73; --secondary:#0a9396; --bg:#f4f4f4; --panel:#fff;
  --text:#333; --label:#555; --border:#ddd; --accent:#ee9b00;
  --resultbg:#e9f5f5; --danger:#ae2012; --blue:#0b72ff;
  --chip-bg:#f0f0f0; --chip-border:#cfcfcf; --chip-red:#e84a4a;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:'Heebo',sans-serif; background:var(--bg); color:var(--text);
  display:flex; justify-content:center; padding:18px;
}
#captureRoot{width:100%; max-width:1000px}
.calculator{
  background:#fff; border-radius:12px; overflow:hidden;
  box-shadow:0 4px 15px rgba(0,0,0,.1);
  display:grid; grid-template-columns:1fr 1fr;
}
header{
  grid-column:1 / -1; background:var(--primary); color:#fff;
  display:flex; gap:10px; justify-content:center; align-items:center;
  padding:14px 18px;
}
header h1{margin:0; font-size:1.6rem}
.update-tag{font-size:.9rem; background:rgba(255,255,255,.15); padding:4px 8px; border-radius:8px}

.inputs{padding:20px; border-left:1px solid var(--border)}
.results{padding:20px; background:var(--resultbg)}

h2.sec{margin:0 0 12px 0; color:var(--primary); border-bottom:2px solid var(--secondary); padding-bottom:6px; font-size:1.2rem}

.row2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
.group{display:flex; flex-direction:column}
label{color:var(--label); font-weight:500; margin-bottom:6px}
input,select,textarea{
  width:100%; border:1px solid var(--border); border-radius:8px; padding:10px; font-size:1rem; background:#fff;
}
input:focus,select:focus,textarea:focus{outline:none; border-color:var(--secondary); box-shadow:0 0 0 3px rgba(10,147,150,.18)}
textarea{min-height:90px; resize:vertical}

/* chips */
.chips{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
.chip{
  padding:8px 14px; border:1px solid var(--chip-border); border-radius:999px;
  background:var(--chip-bg); cursor:pointer; user-select:none; transition:.2s;
}
.chip input{display:none}
.chip.active{background:var(--secondary); color:#fff; border-color:var(--secondary)}
.chip.red.active{background:var(--chip-red); border-color:var(--chip-red); color:#fff}

/* collapses */
.collapse{border:1px solid var(--border); border-radius:10px; overflow:hidden}
.c-head{background:#fafafa; padding:10px 12px; display:flex; justify-content:space-between; align-items:center; cursor:pointer}
.c-body{display:none; padding:12px}
.collapse.open .c-body{display:block}

/* results */
.r-grid{display:grid; grid-template-columns:1fr 1fr; gap:16px; text-align:center}
.r-box .lbl{font-weight:500}
.r-box .val{font-weight:700; color:var(--accent)}
.r-mid{text-align:center; margin:10px 0}
.r-mid .val{color:var(--blue); font-size:1.3rem; font-weight:800}
.r-total{display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-top:1px solid #d4e7e7}
.r-total .val{color:var(--danger); font-size:1.3rem; font-weight:800}
.zero-case{color:var(--secondary)!important}

/* action bar (desktop) */
.actions{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}
.btn{border:1px solid #cbd5e1; background:#fff; border-radius:10px; padding:8px 12px; cursor:pointer; display:inline-flex; align-items:center; gap:8px}
.btn:hover{background:#f8fafc}

/* mobile sticky */
.fab-wrap{display:none}
@media (max-width:768px){
  .calculator{grid-template-columns:1fr}
  .inputs{border-left:none}
  .row2{grid-template-columns:1fr}
  .actions{display:none}        /* אין סרגל בדסקטופ במובייל */
  .fab-wrap{display:flex; position:fixed; right:12px; left:12px; bottom:12px; gap:8px; z-index:9999;
    background:rgba(255,255,255,.92); border:1px solid var(--border); border-radius:14px; padding:8px 10px; box-shadow:0 10px 25px rgba(0,0,0,.15)}
  .fab{flex:1; border:1px solid #cbd5e1; border-radius:10px; background:#fff; padding:10px 12px; font-weight:700; cursor:pointer}
}
@media print{
  .btn,.fab-wrap{display:none!important}
  header{padding:10px}
  .results{background:#fff}
  input,select,textarea{border:none!important; box-shadow:none!important}
}
</style>
</head>
<body>

<div id="captureRoot">
  <div class="calculator" id="calculator">
    <header>
      <h1>מחשבון צו תשלומים</h1>
      <span class="update-tag">מעודכן ל־<span id="yearTag"></span></span>
    </header>

    <!-- קלט -->
    <div class="inputs">
      <h2 class="sec">פרטי התא המשפחתי</h2>

      <!-- שורת על: סטטוס + מי בהליך -->
      <div class="row2" style="align-items:end">
        <div class="group">
          <label for="status">סטטוס משפחתי</label>
          <select id="status">
            <option value="" selected disabled>בחר סטטוס...</option>
            <option value="יחיד/נשוי חי בנפרד">יחיד/נשוי חי בנפרד</option>
            <option value="רווק/גרוש/אלמן + ילד">רווק/גרוש/אלמן + ילד</option>
            <option value="זוג">זוג</option>
            <option value="זוג+ילד">זוג+ילד</option>
            <option value="זוג+ 2 ילדים">זוג+ 2 ילדים</option>
            <option value="זוג+ 3 ילדים">זוג+ 3 ילדים</option>
            <option value="זוג+ 4 ילדים">זוג+ 4 ילדים</option>
            <option value="זוג+ 5 ילדים">זוג+ 5 ילדים</option>
            <option value="זוג+ 6 ילדים">זוג+ 6 ילדים</option>
            <option value="זוג+ 7 ילדים">זוג+ 7 ילדים</option>
            <option value="זוג+ 8 ילדים">זוג+ 8 ילדים</option>
            <option value="זוג+ 9 ילדים">זוג+ 9 ילדים</option>
            <option value="זוג+ 10 ילדים">זוג+ 10 ילדים</option>
          </select>
        </div>

        <div class="group">
          <label>מי בהליך?</label>
          <div class="chips" id="chips">
            <label class="chip" id="chipMale"><input type="radio" name="debtor" id="debtorMale" checked>חייב</label>
            <label class="chip" id="chipFemale"><input type="radio" name="debtor" id="debtorFemale">חייבת</label>
            <label class="chip red" id="chipJoint"><input type="checkbox" id="jointProceeding">שני בני הזוג בהליך</label>
          </div>
        </div>
      </div>

      <h2 class="sec">הכנסות והוצאות (₪)</h2>

      <div class="row2">
        <div class="group"><label id="salaryDebtorLabel">הכנסה (חייב)</label><input type="number" id="salaryDebtor" placeholder="הזן הכנסה"></div>
        <div class="group" id="salaryPartnerWrap"><label id="salaryPartnerLabel">הכנסה (בת זוג)</label><input type="number" id="salaryPartner" placeholder="הזן הכנסה"></div>
      </div>

      <div class="row2">
        <div class="group"><label id="otherDebtorLabel">הכנסות אחרות (חייב)</label><input type="number" id="otherIncomeDebtor" placeholder="הזן הכנסות אחרות"></div>
        <div class="group" id="otherPartnerWrap"><label id="otherPartnerLabel">הכנסות אחרות (בת זוג)</label><input type="number" id="otherIncomePartner" placeholder="הזן הכנסות אחרות"></div>
      </div>

      <div class="collapse" id="collAllow">
        <div class="c-head" data-toggle="#collAllow"><span>הכנסות מקצבאות</span><span>▼</span></div>
        <div class="c-body">
          <div class="row2">
            <div class="group"><label>קצבה (חייב/ת)</label><input type="number" id="debtorAllowance" placeholder="הזן קצבה"></div>
            <div class="group" id="partnerAllowanceWrap"><label>קצבה (בן/בת זוג)</label><input type="number" id="partnerAllowance" placeholder="הזן קצבה"></div>
          </div>
        </div>
      </div>

      <div class="collapse" id="collAlimony">
        <div class="c-head" data-toggle="#collAlimony"><span>הוצאות מזונות</span><span>▼</span></div>
        <div class="c-body">
          <div class="group"><label>הוצאות מזונות</label><input type="number" id="alimonyExpenses" placeholder="הזן הוצאות מזונות"></div>
        </div>
      </div>

      <div class="row2">
        <div class="group"><label>הוצאות חריגות (רפואיות וכו')</label><input type="number" id="unusualExpenses" placeholder="הזן הוצאות"></div>
        <div class="group"><label>הוצאות טיפול וצהרונים</label><input type="number" id="childcareExpenses" placeholder="הזן הוצאות"></div>
      </div>
    </div>

    <!-- תוצאות -->
    <div class="results">
      <!-- סרגל חמישייה בדסקטופ -->
      <div class="actions">
        <button class="btn" id="btnShotDesk">📸 צילום (PNG)</button>
        <button class="btn" id="btnPrintDesk">🖨️ הדפסה</button>
        <button class="btn" id="btnMailDesk">✉️ שלח מייל</button>
        <button class="btn" id="btnResetDesk">↺ איפוס</button>
        <button class="btn" id="btnReportDesk">📄 פרטי דו״ח</button>
      </div>

      <!-- פנל פרטי דו״ח (נסגר כברירת מחדל) -->
      <div class="collapse" id="reportPanel" style="display:none;margin-bottom:10px">
        <div class="c-head">
          <span>פרטי דו״ח</span>
          <button class="btn" id="btnToggleNote" style="margin:0">🗒️ הערה</button>
        </div>
        <div class="c-body">
          <div class="row2">
            <div class="group"><label>מס׳ תיק</label><input type="text" id="caseId" placeholder="לדוגמה: 12345/25"></div>
            <div class="group"><label>שם עורך/ת החישוב</label><input type="text" id="authorName" placeholder="שם מלא"></div>
          </div>
          <div class="row2">
            <div class="group"><label>תאריך</label><input type="text" id="calcDate" readonly></div>
          </div>
          <div class="collapse" id="notePanel" style="margin-top:10px">
            <div class="c-head" data-toggle="#notePanel"><span>הערה (עד 500 תווים)</span><span>▼</span></div>
            <div class="c-body">
              <textarea id="calcNotes" maxlength="500" placeholder="הערה קצרה..."></textarea>
            </div>
          </div>
        </div>
      </div>

      <h2 class="sec" style="margin-top:0">תוצאות החישוב</h2>

      <div class="r-grid">
        <div class="r-box"><div class="lbl">קצבת ביטוח לאומי</div><div class="val" id="ssAllow">0 ₪</div></div>
        <div class="r-box"><div class="lbl">סך הכנסות</div><div class="val" id="sumIncome">0 ₪</div></div>
      </div>

      <div class="r-grid" style="margin-top:10px">
        <div class="r-box"><div class="lbl">דמי מחייה בכבוד</div><div class="val" id="livingCost">0 ₪</div></div>
        <div class="r-box"><div class="lbl">סך הוצאות</div><div class="val" id="sumExpenses">0 ₪</div></div>
      </div>

      <div class="r-mid">
        <div class="lbl">הכנסה פנויה לתא המשפחתי</div>
        <div class="val" id="disposable">0 ₪</div>
      </div>

      <div class="r-grid">
        <div class="r-box"><div class="lbl" id="debtorRatioLabel">אחוז הכנסה (חייב)</div><div class="val" id="debtorRatio">0%</div></div>
        <div class="r-box"><div class="lbl" id="partnerRatioLabel">אחוז הכנסה (בת זוג)</div><div class="val" id="partnerRatio">0%</div></div>
      </div>

      <div class="r-grid" style="margin-top:10px">
        <div class="r-box"><div class="lbl" id="debtorPayLabel">תשלום מוצע (חייב)</div><div class="val" id="debtorPay">0 ₪</div></div>
        <div class="r-box"><div class="lbl" id="partnerPayLabel">תשלום מוצע (בת זוג)</div><div class="val" id="partnerPay">0 ₪</div></div>
      </div>

      <div class="r-total" style="margin-top:6px">
        <div class="lbl" id="familyPayLabel">תשלום חודשי לתא משפחתי</div>
        <div class="val" id="familyPay">0 ₪</div>
      </div>
    </div>
  </div>
</div>

<!-- מובייל: כפתורים צפים -->
<div class="fab-wrap">
  <button class="fab" id="btnShot">📸 צילום</button>
  <button class="fab" id="btnMail">✉️ מייל</button>
  <button class="fab" id="btnReset">↺ איפוס</button>
</div>

<script>
/* === ייבוא שנה ותאריך === */
document.getElementById('yearTag').textContent = new Date().getFullYear();
document.getElementById('calcDate').value = new Date().toLocaleDateString('he-IL',{day:'2-digit',month:'2-digit',year:'numeric'});

/* === נתונים קבועים === */
const lookup = {
  "יחיד/נשוי חי בנפרד": { kids:0, livingCost:4556 },
  "רווק/גרוש/אלמן + ילד": { kids:1, livingCost:6056 },
  "זוג": { kids:0, livingCost:6024 },
  "זוג+ילד": { kids:1, livingCost:7524 },
  "זוג+ 2 ילדים": { kids:2, livingCost:9024 },
  "זוג+ 3 ילדים": { kids:3, livingCost:10524 },
  "זוג+ 4 ילדים": { kids:4, livingCost:12024 },
  "זוג+ 5 ילדים": { kids:5, livingCost:13324 },
  "זוג+ 6 ילדים": { kids:6, livingCost:14624 },
  "זוג+ 7 ילדים": { kids:7, livingCost:15924 },
  "זוג+ 8 ילדים": { kids:8, livingCost:17224 },
  "זוג+ 9 ילדים": { kids:9, livingCost:18524 },
  "זוג+ 10 ילדים": { kids:10, livingCost:19824 }
};
const childAllow = {0:0,1:169,2:383,3:597,4:811,5:980,6:1149,7:1318,8:1487,9:1656,10:1825};
const fmt = n=>new Intl.NumberFormat('he-IL',{style:'currency',currency:'ILS',minimumFractionDigits:0}).format(+n||0);
const r10 = n=>Math.floor((+n||0)/10)*10;

/* === DOM קיצורי דרך === */
const $ = id=>document.getElementById(id);
const statusEl = $('status');
const chipMale=$('chipMale'), chipFemale=$('chipFemale'), chipJoint=$('chipJoint');
const debtorMale=$('debtorMale'), debtorFemale=$('debtorFemale'), jointEl=$('jointProceeding');

const salaryDebtor=$('salaryDebtor'), salaryPartner=$('salaryPartner');
const otherDebtor=$('otherIncomeDebtor'), otherPartner=$('otherIncomePartner');
const debtorAllowance=$('debtorAllowance'), partnerAllowance=$('partnerAllowance');
const unusual=$('unusualExpenses'), childcare=$('childcareExpenses'), alimony=$('alimonyExpenses');

const salaryPartnerWrap=$('salaryPartnerWrap'), otherPartnerWrap=$('otherPartnerWrap'), partnerAllowanceWrap=$('partnerAllowanceWrap');

const salaryDebtorLabel=$('salaryDebtorLabel'), salaryPartnerLabel=$('salaryPartnerLabel');
const otherDebtorLabel=$('otherDebtorLabel'), otherPartnerLabel=$('otherPartnerLabel');

const ssAllow=$('ssAllow'), sumIncome=$('sumIncome'), livingCost=$('livingCost'), sumExpenses=$('sumExpenses'),
      disposable=$('disposable'), debtorRatio=$('debtorRatio'), partnerRatio=$('partnerRatio'),
      debtorPay=$('debtorPay'), partnerPay=$('partnerPay'), familyPay=$('familyPay');

/* === צ׳יפים – בחירה ועיצוב === */
function refreshChips(){
  chipMale.classList.toggle('active', debtorMale.checked);
  chipFemale.classList.toggle('active', debtorFemale.checked);
  chipJoint.classList.toggle('active', jointEl.checked);
}
chipMale.addEventListener('click', ()=>{debtorMale.checked=true; debtorFemale.checked=false; refreshChips(); updateLabels(); calc();});
chipFemale.addEventListener('click', ()=>{debtorFemale.checked=true; debtorMale.checked=false; refreshChips(); updateLabels(); calc();});
chipJoint.addEventListener('click', ()=>{jointEl.checked=!jointEl.checked; refreshChips(); updateLabels(); calc();});

/* === תוויות דינמיות והסתרות === */
function updateLabels(){
  const st = statusEl.value||'';
  const isSingle = st.includes('יחיד') || st.includes('רווק');
  const male = debtorMale.checked;

  salaryPartnerWrap.style.display = isSingle ? 'none' : '';
  otherPartnerWrap.style.display  = isSingle ? 'none' : '';
  partnerAllowanceWrap.style.display = isSingle ? 'none' : '';

  salaryDebtorLabel.textContent = isSingle ? 'הכנסה (חייב/ת)' : male ? 'הכנסה (חייב)' : 'הכנסה (חייבת)';
  salaryPartnerLabel.textContent = isSingle ? 'הכנסה (בן/בת זוג)' : male ? 'הכנסה (בת זוג)' : 'הכנסה (בן זוג)';
  otherDebtorLabel.textContent   = isSingle ? 'הכנסות אחרות (חייב/ת)' : male ? 'הכנסות אחרות (חייב)' : 'הכנסות אחרות (חייבת)';
  otherPartnerLabel.textContent  = isSingle ? 'הכנסות אחרות (בן/בת זוג)' : male ? 'הכנסות אחרות (בת זוג)' : 'הכנסות אחרות (בן זוג)';

  $('debtorRatioLabel').textContent = `אחוז הכנסה (${isSingle?'חייב/ת':(male?'חייב':'חייבת')})`;
  $('partnerRatioLabel').textContent= `אחוז הכנסה (${isSingle?'בן/בת זוג':(male?'בת זוג':'בן זוג')})`;
  $('debtorPayLabel').textContent   = `תשלום מוצע (${isSingle?'חייב/ת':(male?'חייב':'חייבת')})`;
  $('partnerPayLabel').textContent  = `תשלום מוצע (${isSingle?'בן/בת זוג':(male?'בת זוג':'בן זוג')})`;
}

/* === חישוב === */
function calc(){
  const st = statusEl.value||'';
  const data = lookup[st] || {kids:0,livingCost:0};
  const kids = data.kids, baseLC=data.livingCost;

  const sD=+salaryDebtor.value||0, sP=+salaryPartner.value||0;
  const oD=+otherDebtor.value||0,  oP=+otherPartner.value||0;
  const aD=+debtorAllowance.value||0, aP=+partnerAllowance.value||0;
  const un=+unusual.value||0, ch=+childcare.value||0, al=+alimony.value||0;

  const childA = childAllow[kids]||0;

  livingCost.textContent = fmt(baseLC);
  ssAllow.textContent = fmt(childA);

  const totalIncome = sD+sP+oD+oP+aD+aP+childA;
  sumIncome.textContent = fmt(totalIncome);

  const totalExp = baseLC+un+ch+al;
  sumExpenses.textContent = fmt(totalExp);

  const disp = totalIncome-totalExp;
  disposable.textContent = disp<0 ? 'אין הכנסה פנויה' : fmt(disp);

  const totalForRatio = sD+oD+sP+oP;
  const rDeb = totalForRatio>0 ? (sD+oD)/totalForRatio : 0;
  const rPar = totalForRatio>0 ? (sP+oP)/totalForRatio : 0;
  debtorRatio.textContent = (rDeb*100).toFixed(1)+'%';
  partnerRatio.textContent = (rPar*100).toFixed(1)+'%';

  const propDeb = r10((disp * rDeb)/2);
  const propPar = r10((disp * rPar)/2);
  debtorPay.textContent = fmt(Math.max(0,propDeb));
  partnerPay.textContent= fmt(Math.max(0,propPar));

  const isSingle = st.includes('יחיד') || st.includes('רווק');
  const isJoint = jointEl.checked && !isSingle;

  // "תיק אפס" – רק אם יש הכנסות אך ורק מקצבאות ולחייב אין הכנסה/הכנסות אחרות
  const wagesAndOther = sD+sP+oD+oP;
  const allowancesOnly = (aD+aP+childA) > 0 && wagesAndOther === 0;

  let family = 0;
  if(isJoint){
    // נוסחה: (דיספ / 2 - תשלום בת/בן זוג) * יחס חייב  +  תשלום בת/בן זוג
    const baseHalf = Math.max(0, disp/2 - propPar);
    const debtorPort = r10(baseHalf * rDeb);
    family = Math.max(0, debtorPort + propPar);
  }else{
    family = Math.max(0, propDeb);
  }

  const famEl = familyPay;
  famEl.classList.remove('zero-case');
  if (allowancesOnly && sD+oD===0){  // רק קצבאות ולחייב אין הכנסה
    famEl.textContent = 'תיק אפס';
    famEl.classList.add('zero-case');
  } else {
    famEl.textContent = fmt(family);
  }
}

/* === מתקפלים === */
document.querySelectorAll('.c-head').forEach(h=>{
  h.addEventListener('click', e=>{
    const host = h.parentElement;
    if (host.id==='reportPanel' || h.id==='btnToggleNote') return; // מנוהל ידנית
    host.classList.toggle('open');
  });
});

/* === אירועים === */
document.querySelectorAll('input,select,textarea').forEach(el=>{
  el.addEventListener('input', ()=>{ updateLabels(); calc(); });
});
statusEl.addEventListener('change', ()=>{ updateLabels(); calc(); });

/* === פרטי דו״ח / הערה === */
$('btnReportDesk').addEventListener('click', ()=>{
  const p = $('reportPanel');
  p.style.display = p.style.display==='none'?'block':'none';
  p.classList.add('open');
});
$('btnToggleNote').addEventListener('click', ()=>{
  $('notePanel').classList.toggle('open');
});

/* === איפוס === */
function doReset(){
  $('form').reset();
  $('collAllow').classList.remove('open');
  $('collAlimony').classList.remove('open');
  $('reportPanel').style.display='none';
  $('notePanel').classList.remove('open');
  debtorMale.checked=true; debtorFemale.checked=false; jointEl.checked=false;
  refreshChips(); updateLabels(); calc();
}
$('btnResetDesk').addEventListener('click', doReset);
$('btnReset').addEventListener('click', doReset);

/* === צילום עמוד אחד (PNG) === */
async function shotOnePage(){
  const root = $('captureRoot');
  // מסתירים כפתורים צפים בצילום
  document.querySelector('.fab-wrap').style.visibility='hidden';
  const canvas = await html2canvas(root, {scale:1.3, useCORS:true, windowWidth:root.scrollWidth, windowHeight:root.scrollHeight});
  document.querySelector('.fab-wrap').style.visibility='';

  // התאמה לעמוד אחד: גובה יעד ~ 1400px
  const MAX_H = 1400;
  const ratio = Math.min(1, MAX_H / canvas.height);
  const w = Math.round(canvas.width * ratio);
  const h = Math.round(canvas.height * ratio);
  const out = document.createElement('canvas');
  out.width = w; out.height = h;
  out.getContext('2d').drawImage(canvas, 0, 0, w, h);
  const url = out.toDataURL('image/png');

  const win = window.open('','_blank');
  win.document.write(`
    <html dir="rtl"><head><meta charset="utf-8">
    <title>צילום מסך המחשבון</title>
    <style>
      @page{size:A4 portrait; margin:8mm}
      body{margin:0; display:flex; justify-content:center; align-items:flex-start}
      img{width:100%; height:auto; max-height:98vh; page-break-inside:avoid}
    </style>
    </head><body>
      <img src="${url}" alt="capture">
      <script>window.onload=()=>window.print();<\/script>
    </body></html>
  `);
  win.document.close();
}
$('btnShotDesk').addEventListener('click', shotOnePage);
$('btnShot').addEventListener('click', shotOnePage);

/* === הדפסה רגילה של הדף (למי שמעדיף) === */
$('btnPrintDesk').addEventListener('click', ()=>window.print());

/* === מייל (mailto) עם תקציר – לצרף ידנית את ה-PNG שנשמר) === */
function mailSummary(){
  const get = id=> (document.getElementById(id)?.textContent||'').trim();
  const subject = 'מחשבון צו תשלומים – תקציר';
  const body = [
    'מצורף תקציר. נא לצרף ידנית את קובץ ה-PNG מהכפתור "צילום".',
    '',
    'סיכום תוצאות:',
    `סך הכנסות: ${get('sumIncome')}`,
    `סך הוצאות: ${get('sumExpenses')}`,
    `הכנסה פנויה: ${get('disposable')}`,
    `אחוז הכנסה (חייב/ת): ${get('debtorRatio')}`,
    `אחוז הכנסה (בן/בת זוג): ${get('partnerRatio')}`,
    `תשלום מוצע (חייב/ת): ${get('debtorPay')}`,
    `תשלום מוצע (בן/בת זוג): ${get('partnerPay')}`,
    `תשלום חודשי: ${get('familyPay')}`
  ].join('\n');
  window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}
$('btnMailDesk').addEventListener('click', mailSummary);
$('btnMail').addEventListener('click', mailSummary);

/* === אתחול === */
refreshChips(); updateLabels(); calc();
</script>
</body>
</html>
