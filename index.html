<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>מחשבון חדלות פירעון</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    :root { --primary-color:#005f73; --secondary-color:#0a9396; --background-color:#f4f4f4; --container-bg:#ffffff; --text-color:#333; --label-color:#555; --border-color:#ddd; --accent-color:#ee9b00; --result-bg:#e9f5f5; --danger-color:#ae2012; --blue-color:#007bff; }
    body { font-family:'Heebo',sans-serif; background:var(--background-color); color:var(--text-color); margin:0; padding:20px; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; }
    .calculator-container { width:100%; max-width:1000px; background:var(--container-bg); border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,.1); overflow:hidden; display:grid; grid-template-columns:1fr 1fr; }
    header { grid-column:1 / -1; background:var(--primary-color); color:#fff; padding:20px; text-align:center; }
    header h1 { margin:0; font-size:1.8em; }
    .inputs-column { padding:25px; border-left:1px solid var(--border-color); }
    .results-column { padding:25px; background:var(--result-bg); }
    .form-section { display:grid; gap:20px; }
    .form-section h2 { grid-column:1/-1; margin:0 0 10px; color:var(--primary-color); border-bottom:2px solid var(--secondary-color); padding-bottom:8px; font-size:1.4em; }
    .input-group { display:flex; flex-direction:column; width:100%; }
    .input-group label { font-weight:500; margin-bottom:8px; color:var(--label-color); }
    .input-group input, .input-group select { width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; font-size:1em; box-sizing:border-box; transition:border-color .3s, box-shadow .3s; }
    .input-group input:focus, .input-group select:focus { outline:none; border-color:var(--secondary-color); box-shadow:0 0 0 3px rgba(10,147,150,.2); }
    .results-section h2 { margin:0 0 20px; color:var(--primary-color); font-size:1.4em; text-align:center; }
    .result-item { display:flex; justify-content:space-between; align-items:center; padding:12px 0; font-size:1.1em; border-bottom:1px solid #d4e7e7; }
    .result-item:last-child { border-bottom:none; }
    .result-item.side-by-side { display:grid; grid-template-columns:1fr 1fr; gap:20px; justify-items:center; text-align:center; }
    .result-item .value { font-weight:bold; font-size:1.2em; color:var(--accent-color); }
    .result-item .label { font-weight:500; }
    .result-item.disposable-income { display:block; text-align:center; }
    .result-item.disposable-income .value { color:var(--blue-color); font-size:1.5em; font-weight:bold; display:block; margin-top:5px; }
    .result-item.total .value { color:var(--danger-color); font-size:1.5em; }
    .input-pair-inline { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
    #special-note { background:#fff3cd; border:1px solid #ffeeba; color:#856404; padding:15px; border-radius:6px; margin-top:20px; display:none; }
    .top-section-buttons-container { display:flex; align-items:flex-end; justify-content:space-between; flex-wrap:wrap; gap:15px; margin-bottom:15px; }
    .debtor-selection-options { display:flex; gap:10px; }
    .radio-button-label { background:#f0f0f0; border:1px solid #ccc; padding:8px 16px; border-radius:20px; cursor:pointer; transition:background-color .3s, border-color .3s; }
    .radio-button-label.checked { background:var(--secondary-color); color:#fff; border-color:var(--secondary-color); }
    .radio-button-input { display:none; }
    #jointProceedingLabel { background:#f0f0f0; border:1px solid #ccc; padding:8px 16px; border-radius:20px; cursor:pointer; transition:background-color .3s, border-color .3s; display:inline-block; }
    #jointProceedingLabel.checked { background:var(--danger-color); color:#fff; border-color:var(--danger-color); }
    #jointProceeding { display:none; }
    @media (max-width:768px){ .calculator-container{grid-template-columns:1fr;} .inputs-column{border-left:none;} .top-section-buttons-container{flex-direction:column; align-items:flex-start;} }
  </style>
</head>
<body>
  <div class="calculator-container">
    <header><h1>מחשבון צו תשלומים</h1></header>
    <div class="inputs-column">
      <form id="calculatorForm">
        <section class="form-section">
          <h2>פרטי התא המשפחתי</h2>
          <div class="top-section-buttons-container">
            <div class="input-group">
              <label for="status">סטטוס משפחתי</label>
              <select id="status">
                <option value="" selected disabled>בחר סטטוס...</option>
                <option value="יחיד/נשוי חי בנפרד">יחיד/נשוי חי בנפרד</option>
                <option value="רווק/גרוש/אלמן + ילד">רווק/גרוש/אלמן + ילד</option>
                <option value="זוג">זוג</option>
                <option value="זוג+ילד">זוג+ילד</option>
                <option value="זוג+ 2 ילדים">זוג+ 2 ילדים</option>
                <option value="זוג+ 3 ילדים">זוג+ 3 ילדים</option>
                <option value="זוג+ 4 ילדים">זוג+ 4 ילדים</option>
                <option value="זוג+ 5 ילדים">זוג+ 5 ילדים</option>
                <option value="זוג+ 6 ילדים">זוג+ 6 ילדים</option>
                <option value="זוג+ 7 ילדים">זוג+ 7 ילדים</option>
                <option value="זוג+ 8 ילדים">זוג+ 8 ילדים</option>
                <option value="זוג+ 9 ילדים">זוג+ 9 ילדים</option>
                <option value="זוג+ 10 ילדים">זוג+ 10 ילדים</option>
              </select>
            </div>
            <div class="debtor-selection-group" id="debtor-selection">
              <label>מי בהליך?</label>
              <div class="debtor-selection-options">
                <input class="radio-button-input" type="radio" id="debtor-male" name="debtor-gender" value="חייב" checked>
                <label class="radio-button-label" for="debtor-male">חייב</label>
                <input class="radio-button-input" type="radio" id="debtor-female" name="debtor-gender" value="חייבת">
                <label class="radio-button-label" for="debtor-female">חייבת</label>
              </div>
            </div>
            <div class="joint-proceeding-group" id="joint-proceeding-group">
              <label for="jointProceeding" id="jointProceedingLabel">שני בני הזוג בהליך?</label>
              <input type="checkbox" id="jointProceeding">
            </div>
          </div>
        </section>

        <section class="form-section">
          <h2>הכנסות והוצאות התא המשפחתי (₪)</h2>
          <div class="input-pair-inline">
            <div class="input-group">
              <label id="salaryDebtorLabel">הכנסה (בן/בת זוג)</label>
              <input type="number" id="salaryDebtor" placeholder="הזן הכנסה" value="">
            </div>
            <div class="input-group">
              <label id="salaryPartnerLabel">הכנסה (חייב)</label>
              <input type="number" id="salaryPartner" placeholder="הזן הכנסה" value="">
            </div>
          </div>
          <div class="input-pair-inline">
            <div class="input-group">
              <label id="otherIncomeDebtorLabel">הכנסות אחרות (בן/בת זוג)</label>
              <input type="number" id="otherIncomeDebtor" placeholder="הזן הכנסות אחרות" value="">
            </div>
            <div class="input-group">
              <label id="otherIncomePartnerLabel">הכנסות אחרות (חייב)</label>
              <input type="number" id="otherIncomePartner" placeholder="הזן הכנסות אחרות" value="">
            </div>
          </div>
          <div class="input-group">
            <button type="button" id="allowanceButton">הכנסות מקצבאות</button>
          </div>
          <div id="allowanceFields" style="display:none">
            <div class="input-pair-inline">
              <div class="input-group">
                <label for="debtorAllowance">קצבה (בן/בת זוג)</label>
                <input type="number" id="debtorAllowance" placeholder="הזן קצבה" value="">
              </div>
              <div class="input-group">
                <label for="partnerAllowance">קצבה (חייב/ת)</label>
                <input type="number" id="partnerAllowance" placeholder="הזן קצבה" value="">
              </div>
            </div>
          </div>
          <hr>
          <div class="input-pair-inline">
            <div class="input-group">
              <label>הוצאות חריגות (רפואיות וכו')</label>
              <input type="number" id="unusualExpenses" placeholder="הזן הוצאות" value="">
            </div>
            <div class="input-group">
              <label>הוצאות טיפול וצהרונים</label>
              <input type="number" id="childcareExpenses" placeholder="הזן הוצאות" value="">
            </div>
          </div>
          <div class="input-group">
            <button type="button" id="alimonyButton">הוצאות מזונות</button>
          </div>
          <div id="alimonyFields" style="display:none">
            <div class="input-pair-inline">
              <div class="input-group">
                <label for="alimonyExpenses">הוצאות מזונות</label>
                <input type="number" id="alimonyExpenses" placeholder="הזן הוצאות מזונות" value="">
              </div>
            </div>
          </div>
        </section>
      </form>
      <div id="special-note"><strong>הערה:</strong> לחייב שלא עובד יקבע תשלום זמני של 150 ₪ ותשלום עתידי החל מ-3 חודשים קדימה עפ"י הכנסה רעיונית של שכר מינימום בסך 4,600 ש"ח.</div>
    </div>

    <div class="results-column">
      <section class="results-section">
        <h2 style="text-align:center">תוצאות החישוב</h2>
        <div class="result-item side-by-side">
          <div class="value-group"><span class="label">קצבת ביטוח לאומי:</span><span class="value" id="socialSecurityAllowance"></span></div>
          <div class="value-group"><span class="label">סך הכנסות:</span><span class="value" id="totalIncomeResult"></span></div>
        </div>
        <hr>
        <div class="result-item side-by-side">
          <div class="value-group"><span class="label" id="livingCostLabel">דמי מחייה בכבוד:</span><span class="value" id="baseLivingCostResult"></span></div>
          <div class="value-group"><span class="label">סך הוצאות:</span><span class="value" id="totalExpensesResult"></span></div>
        </div>
        <hr>
        <div class="result-item disposable-income"><span class="label">הכנסה פנויה לתא המשפחתי:</span><span class="value" id="disposableIncomeResult"></span></div>
        <hr>
        <div class="result-item side-by-side">
          <div class="value-group"><span class="label" id="debtorIncomeRatioLabel">אחוז הכנסה (חייב/ת):</span><span class="value" id="debtorIncomeRatio"></span></div>
          <div class="value-group"><span class="label" id="partnerIncomeRatioLabel">אחוז הכנסה (בן/בת זוג):</span><span class="value" id="partnerIncomeRatio"></span></div>
        </div>
        <hr>
        <div class="result-item side-by-side" id="proposedPaymentsDisplay">
          <div class="value-group"><span class="label" id="debtorPaymentLabel">תשלום מוצע (חייב/ת):</span><span class="value" id="debtorPaymentResult"></span></div>
          <div class="value-group"><span class="label" id="partnerPaymentLabel">תשלום מוצע (בן/בת זוג):</span><span class="value" id="partnerPaymentResult"></span></div>
        </div>
        <div class="result-item total" id="finalPaymentDisplay"><span class="label">תשלום חודשי לתא משפחתי:</span><span class="value" id="finalPaymentResult"></span></div>
      </section>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const lookupData = {
      'יחיד/נשוי חי בנפרד': { kids: 0, livingCost: 4556 },
      'רווק/גרוש/אלמן + ילד': { kids: 1, livingCost: 6056 },
      'זוג': { kids: 0, livingCost: 6024 },
      'זוג+ילד': { kids: 1, livingCost: 7524 },
      'זוג+ 2 ילדים': { kids: 2, livingCost: 9024 },
      'זוג+ 3 ילדים': { kids: 3, livingCost: 10524 },
      'זוג+ 4 ילדים': { kids: 4, livingCost: 12024 },
      'זוג+ 5 ילדים': { kids: 5, livingCost: 13324 },
      'זוג+ 6 ילדים': { kids: 6, livingCost: 14624 },
      'זוג+ 7 ילדים': { kids: 7, livingCost: 15924 },
      'זוג+ 8 ילדים': { kids: 8, livingCost: 17224 },
      'זוג+ 9 ילדים': { kids: 9, livingCost: 18524 },
      'זוג+ 10 ילדים': { kids: 10, livingCost: 19824 },
    };
    const childAllowanceData = {0:0,1:169,2:383,3:597,4:811,5:980,6:1149,7:1318,8:1487,9:1656,10:1825};

    const form = document.getElementById('calculatorForm');
    const inputs = form.querySelectorAll('input, select');

    const salaryDebtorEl = document.getElementById('salaryDebtor'); // שמאל
    const salaryPartnerEl = document.getElementById('salaryPartner'); // ימין (החייב/ת תמיד כאן)
    const otherIncomeDebtorEl = document.getElementById('otherIncomeDebtor'); // שמאל
    const otherIncomePartnerEl = document.getElementById('otherIncomePartner'); // ימין
    const debtorAllowanceEl = document.getElementById('debtorAllowance'); // שמאל
    const partnerAllowanceEl = document.getElementById('partnerAllowance'); // ימין

    const unusualExpensesEl = document.getElementById('unusualExpenses');
    const childcareExpensesEl = document.getElementById('childcareExpenses');
    const alimonyExpensesEl = document.getElementById('alimonyExpenses');

    const statusEl = document.getElementById('status');
    const debtorMaleEl = document.getElementById('debtor-male');
    const debtorFemaleEl = document.getElementById('debtor-female');
    const jointProceedingEl = document.getElementById('jointProceeding');

    const allowanceButtonEl = document.getElementById('allowanceButton');
    const allowanceFieldsEl = document.getElementById('allowanceFields');
    const alimonyButtonEl = document.getElementById('alimonyButton');
    const alimonyFieldsEl = document.getElementById('alimonyFields');

    const salaryDebtorLabelEl = document.getElementById('salaryDebtorLabel');
    const salaryPartnerLabelEl = document.getElementById('salaryPartnerLabel');
    const otherIncomeDebtorLabelEl = document.getElementById('otherIncomeDebtorLabel');
    const otherIncomePartnerLabelEl = document.getElementById('otherIncomePartnerLabel');
    const debtorIncomeRatioLabelEl = document.getElementById('debtorIncomeRatioLabel');
    const partnerIncomeRatioLabelEl = document.getElementById('partnerIncomeRatioLabel');
    const debtorPaymentLabelEl = document.getElementById('debtorPaymentLabel');
    const partnerPaymentLabelEl = document.getElementById('partnerPaymentLabel');

    const baseLivingCostResultEl = document.getElementById('baseLivingCostResult');
    const socialSecurityAllowanceEl = document.getElementById('socialSecurityAllowance');
    const disposableIncomeResultEl = document.getElementById('disposableIncomeResult');
    const debtorIncomeRatioEl = document.getElementById('debtorIncomeRatio');
    const partnerIncomeRatioEl = document.getElementById('partnerIncomeRatio');
    const debtorPaymentResultEl = document.getElementById('debtorPaymentResult');
    const partnerPaymentResultEl = document.getElementById('partnerPaymentResult');
    const finalPaymentResultEl = document.getElementById('finalPaymentResult');
    const specialNoteEl = document.getElementById('special-note');
    const debtorSelectionGroup = document.getElementById('debtor-selection');
    const totalIncomeResultEl = document.getElementById('totalIncomeResult');
    const totalExpensesResultEl = document.getElementById('totalExpensesResult');
    const jointProceedingLabelEl = document.getElementById('jointProceedingLabel');
    const proposedPaymentsDisplayEl = document.getElementById('proposedPaymentsDisplay');
    const finalPaymentDisplayEl = document.getElementById('finalPaymentDisplay');

    const formatCurrency = (value) => (typeof value !== 'number' || isNaN(value)) ? '0 ₪' : new Intl.NumberFormat('he-IL',{style:'currency',currency:'ILS',minimumFractionDigits:0}).format(value);
    const round10 = (n) => Math.floor(n/10)*10;

    const updateLabelsAndUI = () => {
      const status = statusEl.value;
      const isSingle = status.includes('יחיד') || status.includes('רווק');
      const isMaleDebtor = debtorMaleEl.checked;
      const isJoint = jointProceedingEl.checked;

      // הצגת/הסתרת כפתור הליך משותף
      debtorSelectionGroup.style.display = 'flex';
      document.getElementById('joint-proceeding-group').style.display = isSingle ? 'none' : 'flex';

      // הצגת שדות בן/בת זוג במצב יחיד/ה
      const salaryPartnerGroup = salaryPartnerEl.closest('.input-group');
      const otherIncomePartnerGroup = otherIncomePartnerEl.closest('.input-group');
      if (salaryPartnerGroup) salaryPartnerGroup.style.display = 'flex'; // תמיד נראה (כי תמיד החייב/ת מימין)
      if (otherIncomePartnerGroup) otherIncomePartnerGroup.style.display = 'flex';

      // סטייל של הכפתורים
      document.querySelectorAll('.radio-button-label').forEach(l=>l.classList.remove('checked'));
      document.querySelector(`label[for="${isMaleDebtor?'debtor-male':'debtor-female'}"]`).classList.add('checked');
      jointProceedingLabelEl.classList.toggle('checked', isJoint);

      // תוויות קלט: החייב/ת תמיד מימין
      if (isSingle) {
        salaryPartnerLabelEl.textContent = 'הכנסה (חייב/ת)';
        otherIncomePartnerLabelEl.textContent = 'הכנסות אחרות (חייב/ת)';
        salaryDebtorLabelEl.textContent = 'הכנסה (בן/בת זוג)';
        otherIncomeDebtorLabelEl.textContent = 'הכנסות אחרות (בן/בת זוג)';
      } else if (isMaleDebtor) {
        salaryPartnerLabelEl.textContent = 'הכנסה (חייב)';
        otherIncomePartnerLabelEl.textContent = 'הכנסות אחרות (חייב)';
        salaryDebtorLabelEl.textContent = 'הכנסה (בת זוג)';
        otherIncomeDebtorLabelEl.textContent = 'הכנסות אחרות (בת זוג)';
      } else {
        salaryPartnerLabelEl.textContent = 'הכנסה (חייבת)';
        otherIncomePartnerLabelEl.textContent = 'הכנסות אחרות (חייבת)';
        salaryDebtorLabelEl.textContent = 'הכנסה (בן זוג)';
        otherIncomeDebtorLabelEl.textContent = 'הכנסות אחרות (בן זוג)';
      }

      // תוויות בתוצאות
      debtorIncomeRatioLabelEl.textContent = `אחוז הכנסה (${isSingle? 'חייב/ת' : (isMaleDebtor? 'חייב' : 'חייבת')}):`;
      partnerIncomeRatioLabelEl.textContent = 'אחוז הכנסה (בן/בת זוג):';
      debtorPaymentLabelEl.textContent = `תשלום מוצע (${isSingle? 'חייב/ת' : (isMaleDebtor? 'חייב' : 'חייבת')}):`;
      partnerPaymentLabelEl.textContent = 'תשלום מוצע (בן/בת זוג):';

      // תווית התשלום הסופי
      if (isJoint) {
        proposedPaymentsDisplayEl.style.display = 'grid';
        finalPaymentDisplayEl.style.display = 'block';
        finalPaymentDisplayEl.querySelector('.label').textContent = 'תשלום חודשי לתא משפחתי:';
      } else {
        proposedPaymentsDisplayEl.style.display = 'none';
        finalPaymentDisplayEl.style.display = 'block';
        finalPaymentDisplayEl.querySelector('.label').textContent = 'תשלום חודשי (חייב/ת):';
      }
    };

    const calculate = () => {
      const status = statusEl.value;
      const isSingle = status.includes('יחיד') || status.includes('רווק');
      const isJoint = jointProceedingEl.checked;

      // קריאה גולמית
      const A_salary = parseFloat(salaryDebtorEl.value) || 0; // שמאל = בן/בת זוג
      const B_salary = parseFloat(salaryPartnerEl.value) || 0; // ימין = חייב/ת
      const A_other  = parseFloat(otherIncomeDebtorEl.value) || 0; // שמאל
      const B_other  = parseFloat(otherIncomePartnerEl.value) || 0; // ימין
      const A_allow  = parseFloat(debtorAllowanceEl.value) || 0; // שמאל
      const B_allow  = parseFloat(partnerAllowanceEl.value) || 0; // ימין

      // מיפוי קבוע: החייב/ת תמיד מימין
      let debtorSalary = B_salary, debtorOther = B_other, debtorAllow = B_allow;
      let partnerSalary = A_salary, partnerOther = A_other, partnerAllow = A_allow;

      // יחיד/ה: מתעלמים לגמרי מהצד השמאלי
      if (isSingle) { partnerSalary = 0; partnerOther = 0; partnerAllow = 0; }

      // עלויות בסיס
      const statusData = lookupData[status] || { kids:0, livingCost:0 };
      const baseLiving = statusData.livingCost;
      const childAllowance = childAllowanceData[statusData.kids] || 0;
      baseLivingCostResultEl.textContent = formatCurrency(baseLiving);
      socialSecurityAllowanceEl.textContent = formatCurrency(childAllowance);

      // הערת חייב לא עובד
      specialNoteEl.style.display = (debtorSalary === 0 && !isSingle) ? 'block' : 'none';

      // אחוזי הכנסה
      const totalForRatio = debtorSalary + debtorOther + partnerSalary + partnerOther;
      let debtorRatio = 0, partnerRatio = 0;
      if (totalForRatio > 0) {
        debtorRatio  = (debtorSalary + debtorOther) / totalForRatio;
        partnerRatio = (partnerSalary + partnerOther) / totalForRatio;
      }
      debtorIncomeRatioEl.textContent = `${(debtorRatio*100).toFixed(1)}%`;
      partnerIncomeRatioEl.textContent = `${(partnerRatio*100).toFixed(1)}%`;

      // סך הכנסות/הוצאות
      const totalIncome = debtorSalary + partnerSalary + debtorOther + partnerOther + debtorAllow + partnerAllow + childAllowance;
      totalIncomeResultEl.textContent = formatCurrency(totalIncome);
      const totalExpenses = baseLiving + (parseFloat(unusualExpensesEl.value)||0) + (parseFloat(childcareExpensesEl.value)||0) + (parseFloat(alimonyExpensesEl.value)||0);
      totalExpensesResultEl.textContent = formatCurrency(totalExpenses);

      // פנוי
      const disposable = totalIncome - totalExpenses;
      disposableIncomeResultEl.textContent = disposable < 0 ? 'אין הכנסה פנויה' : formatCurrency(disposable);

      // תשלומים מוצעים
      let debtorPayment = 0, partnerPayment = 0;
      if (disposable > 0) {
        if (debtorRatio > 0) debtorPayment = round10((disposable * debtorRatio) / 2);
        if (partnerRatio > 0) partnerPayment = round10((disposable * partnerRatio) / 2);
      }
      debtorPaymentResultEl.textContent = formatCurrency(Math.max(0, debtorPayment));
      partnerPaymentResultEl.textContent = formatCurrency(Math.max(0, partnerPayment));

      // תשלום סופי
      let final = 0;
      if (isSingle) {
        final = Math.max(0, debtorPayment);
      } else if (isJoint) {
        if (disposable > 0) final = round10(Math.max(0, disposable - partnerPayment) / 2);
      } else {
        final = Math.max(0, debtorPayment);
      }
      finalPaymentResultEl.textContent = formatCurrency(final);
    };

    // מאזינים
    inputs.forEach(el => el.addEventListener('input', () => { updateLabelsAndUI(); calculate(); }));
    document.getElementById('debtor-male').addEventListener('change', () => { updateLabelsAndUI(); calculate(); });
    document.getElementById('debtor-female').addEventListener('change', () => { updateLabelsAndUI(); calculate(); });
    document.getElementById('status').addEventListener('change', () => { updateLabelsAndUI(); calculate(); });
    document.getElementById('jointProceeding').addEventListener('change', () => { updateLabelsAndUI(); calculate(); });
    allowanceButtonEl.addEventListener('click', () => { allowanceFieldsEl.style.display = allowanceFieldsEl.style.display==='none'?'grid':'none'; calculate(); });
    alimonyButtonEl.addEventListener('click', () => { alimonyFieldsEl.style.display = alimonyFieldsEl.style.display==='none'?'block':'none'; calculate(); });

    // התחול
    updateLabelsAndUI();
    calculate();
  });
  </script>
</body>
</html>
